<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Slideshow Independence Test - NxaImage Component</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .nav-bar {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 30px;
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .nav-btn {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 2px solid rgba(255,255,255,0.3);
            padding: 10px 20px;
            border-radius: 20px;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .nav-btn:hover {
            background: rgba(255,255,255,0.3);
            border-color: rgba(255,255,255,0.5);
            transform: translateY(-2px);
        }
        
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }
        
        .test-instance {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
        }
        
        .test-instance:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
        }
        
        .test-instance h3 {
            color: #4facfe;
            margin-bottom: 15px;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .instance-info {
            background: #e8f4fd;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-family: monospace;
            font-size: 12px;
            border-left: 4px solid #4facfe;
        }
        
        .timer-display {
            background: #f8f9fa;
            padding: 8px 12px;
            border-radius: 6px;
            font-family: monospace;
            font-size: 14px;
            text-align: center;
            margin-bottom: 15px;
            border: 1px solid #dee2e6;
        }
        
        nxa-image {
            width: 100%;
            height: 250px;
            border: 2px solid #ddd;
            border-radius: 8px;
            margin: 15px 0;
            display: block;
        }
        
        .test-controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 15px;
        }
        
        .btn {
            background: linear-gradient(45deg, #4facfe, #00f2fe);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        
        .btn.success { background: linear-gradient(45deg, #43e97b, #38f9d7); }
        .btn.warning { background: linear-gradient(45deg, #ffc107, #ff8c00); }
        .btn.danger { background: linear-gradient(45deg, #fa709a, #fee140); }
        
        .test-results {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .test-results h3 {
            color: #4facfe;
            margin-bottom: 20px;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
        }
        
        .result-item {
            margin: 10px 0;
            padding: 12px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 13px;
        }
        
        .result-success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        
        .result-error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        
        .result-info {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
        }
        
        .result-warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
        }
        
        .synchronization-test {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
        }
        
        .synchronization-test h3 {
            color: #856404;
            margin-bottom: 15px;
        }
        
        .sync-controls {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-top: 20px;
        }
        
        .sync-btn {
            background: linear-gradient(45deg, #ffc107, #ff8c00);
            color: #333;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .sync-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        
        .console-output {
            background: #2d3748;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 15px;
        }
        
        .performance-metrics {
            background: #e8f5e8;
            border: 2px solid #28a745;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
        }
        
        .performance-metrics h3 {
            color: #28a745;
            margin-bottom: 15px;
        }
        
        .metric-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .metric-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid #dee2e6;
        }
        
        .metric-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #28a745;
            margin-bottom: 5px;
        }
        
        .metric-label {
            font-size: 0.9rem;
            color: #666;
        }
        
        @media (max-width: 768px) {
            .test-grid {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .nav-bar {
                flex-direction: column;
                align-items: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üé† Slideshow Independence Test</h1>
            <p>Test multiple slideshows running simultaneously without conflicts</p>
        </div>
        
        <div class="nav-bar">
            <a href="test-dashboard.html" class="nav-btn">üè† Dashboard</a>
            <a href="test-multiple-instances.html" class="nav-btn">üöÄ Multiple Instances</a>
            <a href="test-fullscreen-isolation.html" class="nav-btn">üîç Fullscreen Test</a>
            <a href="test-performance.html" class="nav-btn">‚ö° Performance</a>
        </div>
        
        <div class="test-grid">
            <div class="test-instance">
                <h3>üêå Instance 1: Slow Slideshow</h3>
                <div class="instance-info">
                    Features: slideshow, arrows, indicators, fullsize<br>
                    Interval: 5 seconds (slowest)
                </div>
                <div class="timer-display" id="timer-1">‚è±Ô∏è Next slide in: 5.0s</div>
                <nxa-image data-features="slideshow arrows indicators fullsize" interval="5000" debug="true">
                    <img src="https://picsum.photos/400/250?random=10" alt="Nature 1" data-caption="Peaceful forest">
                    <img src="https://picsum.photos/400/250?random=11" alt="Nature 2" data-caption="Mountain lake">
                    <img src="https://picsum.photos/400/250?random=12" alt="Nature 3" data-caption="Sunset beach">
                </nxa-image>
                <div class="test-controls">
                    <button class="btn" onclick="testSlideshow(0)">Test Slideshow</button>
                    <button class="btn success" onclick="checkInstanceStatus(0)">Check Status</button>
                    <button class="btn warning" onclick="pauseResumeSlideshow(0)">Pause/Resume</button>
                </div>
            </div>
            
            <div class="test-instance">
                <h3>üê¢ Instance 2: Medium Slideshow</h3>
                <div class="instance-info">
                    Features: slideshow, arrows, indicators, fullsize<br>
                    Interval: 3 seconds (medium)
                </div>
                <div class="timer-display" id="timer-2">‚è±Ô∏è Next slide in: 3.0s</div>
                <nxa-image data-features="slideshow arrows indicators fullsize" interval="3000" debug="true">
                    <img src="https://picsum.photos/400/250?random=20" alt="Urban 1" data-caption="City skyline">
                    <img src="https://picsum.photos/400/250?random=21" alt="Urban 2" data-caption="Street art">
                    <img src="https://picsum.photos/400/250?random=22" alt="Urban 3" data-caption="Night city">
                </nxa-image>
                <div class="test-controls">
                    <button class="btn" onclick="testSlideshow(1)">Test Slideshow</button>
                    <button class="btn success" onclick="checkInstanceStatus(1)">Check Status</button>
                    <button class="btn warning" onclick="pauseResumeSlideshow(1)">Pause/Resume</button>
                </div>
            </div>
            
            <div class="test-instance">
                <h3>üê∞ Instance 3: Fast Slideshow</h3>
                <div class="instance-info">
                    Features: slideshow, arrows, indicators, fullsize<br>
                    Interval: 1.5 seconds (fastest)
                </div>
                <div class="timer-display" id="timer-3">‚è±Ô∏è Next slide in: 1.5s</div>
                <nxa-image data-features="slideshow arrows indicators fullsize" interval="1500" debug="true">
                    <img src="https://picsum.photos/400/250?random=30" alt="Abstract 1" data-caption="Colorful patterns">
                    <img src="https://picsum.photos/400/250?random=31" alt="Abstract 2" data-caption="Geometric shapes">
                    <img src="https://picsum.photos/400/250?random=32" alt="Abstract 3" data-caption="Artistic composition">
                </nxa-image>
                <div class="test-controls">
                    <button class="btn" onclick="testSlideshow(2)">Test Slideshow</button>
                    <button class="btn success" onclick="checkInstanceStatus(2)">Check Status</button>
                    <button class="btn warning" onclick="pauseResumeSlideshow(2)">Pause/Resume</button>
                </div>
            </div>
            
            <div class="test-instance">
                <h3>üé≠ Instance 4: Variable Slideshow</h3>
                <div class="instance-info">
                    Features: slideshow, arrows, indicators, fullsize<br>
                    Interval: 2.5 seconds (variable)
                </div>
                <div class="timer-display" id="timer-4">‚è±Ô∏è Next slide in: 2.5s</div>
                <nxa-image data-features="slideshow arrows indicators fullsize" interval="2500" debug="true">
                    <img src="https://picsum.photos/400/250?random=40" alt="Portrait 1" data-caption="Human expression">
                    <img src="https://picsum.photos/400/250?random=41" alt="Portrait 2" data-caption="Emotional moment">
                    <img src="https://picsum.photos/400/250?random=42" alt="Portrait 3" data-caption="Cultural heritage">
                </nxa-image>
                <div class="test-controls">
                    <button class="btn" onclick="testSlideshow(3)">Test Slideshow</button>
                    <button class="btn success" onclick="checkInstanceStatus(3)">Check Status</button>
                    <button class="btn warning" onclick="pauseResumeSlideshow(3)">Pause/Resume</button>
                </div>
            </div>
        </div>
        
        <div class="synchronization-test">
            <h3>üß™ Synchronization Test: Multiple Slideshows</h3>
            <p>This test verifies that multiple slideshows can run independently at different speeds without interfering with each other:</p>
            <ol style="margin: 15px 0; padding-left: 20px;">
                <li><strong>Watch all slideshows</strong> - Each should advance at its own interval</li>
                <li><strong>Use navigation arrows</strong> - Should work independently per instance</li>
                <li><strong>Pause/resume individual slideshows</strong> - Should not affect others</li>
                <li><strong>Check indicators</strong> - Each should show correct progress</li>
                <li><strong>Open fullscreen</strong> - Slideshow should continue in background</li>
            </ol>
            <div class="sync-controls">
                <button class="sync-btn" onclick="runSyncTest()">üöÄ Run Sync Test</button>
                <button class="sync-btn" onclick="pauseAllSlideshows()">‚è∏Ô∏è Pause All</button>
                <button class="sync-btn" onclick="resumeAllSlideshows()">‚ñ∂Ô∏è Resume All</button>
                <button class="sync-btn" onclick="resetAllSlideshows()">üîÑ Reset All</button>
            </div>
        </div>
        
        <div class="performance-metrics">
            <h3>üìä Performance Metrics</h3>
            <p>Monitor the performance of multiple slideshows running simultaneously:</p>
            <div class="metric-grid">
                <div class="metric-item">
                    <div class="metric-value" id="metric-instances">4</div>
                    <div class="metric-label">Active Instances</div>
                </div>
                <div class="metric-item">
                    <div class="metric-value" id="metric-total-intervals">4</div>
                    <div class="metric-label">Total Intervals</div>
                </div>
                <div class="metric-item">
                    <div class="metric-value" id="metric-memory-usage">--</div>
                    <div class="metric-label">Memory Usage</div>
                </div>
                <div class="metric-item">
                    <div class="metric-value" id="metric-fps">--</div>
                    <div class="metric-label">FPS</div>
                </div>
            </div>
        </div>
        
        <div class="test-results">
            <h3>üìä Test Results</h3>
            <div id="test-results">
                <p>Click the test buttons above to start testing slideshow independence.</p>
            </div>
            
            <div class="console-output" id="console-output" style="display: none;">
                <strong>Console Output:</strong>
                <div id="console-content"></div>
            </div>
            
            <div class="test-controls" style="margin-top: 20px;">
                <button class="btn success" onclick="showConsoleOutput()">üì∫ Toggle Console</button>
                <button class="btn warning" onclick="clearResults()">üóëÔ∏è Clear Results</button>
                <button class="btn danger" onclick="runFullTest()">üß™ Run Full Test Suite</button>
            </div>
        </div>
    </div>
    
    <script type="module">
        // Import the component
        import { NxaImage } from './dist/nextrap-image.mjs';
        
        // Store console output and timers
        let consoleOutput = [];
        let timers = {};
        let performanceMetrics = {
            instances: 0,
            totalIntervals: 0,
            memoryUsage: 0,
            fps: 0
        };
        
        // Override console.log to capture output
        const originalLog = console.log;
        console.log = function(...args) {
            originalLog.apply(console, args);
            consoleOutput.push({
                timestamp: new Date().toLocaleTimeString(),
                message: args.map(arg => typeof arg === 'object' ? JSON.stringify(arg, null, 2) : String(arg)).join(' ')
            });
            updateConsoleOutput();
        };
        
        // Wait for DOM to be ready
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ Slideshow Independence Test loaded');
            
            // Check component availability and start timers
            setTimeout(function() {
                const instances = document.querySelectorAll('nxa-image');
                console.log(`üìä Found ${instances.length} NxaImage instances for slideshow testing`);
                
                instances.forEach(function(instance, index) {
                    console.log(`Instance ${index + 1} ready for slideshow testing`);
                    startTimer(index, getInstanceInterval(instance));
                });
                
                updatePerformanceMetrics();
            }, 500);
        });
        
        // Timer functions
        function startTimer(instanceIndex, interval) {
            if (timers[instanceIndex]) {
                clearInterval(timers[instanceIndex]);
            }
            
            let timeLeft = interval / 1000;
            const timerDisplay = document.getElementById(`timer-${instanceIndex + 1}`);
            
            timers[instanceIndex] = setInterval(function() {
                timeLeft = interval / 1000;
                if (timerDisplay) {
                    timerDisplay.textContent = `‚è±Ô∏è Next slide in: ${timeLeft.toFixed(1)}s`;
                }
            }, 100);
        }
        
        function getInstanceInterval(instance) {
            return instance.interval || 3000;
        }
        
        function updatePerformanceMetrics() {
            const instances = document.querySelectorAll('nxa-image');
            const slideshowInstances = Array.from(instances).filter(instance => 
                instance.dataFeatures && instance.dataFeatures.includes('slideshow')
            );
            
            performanceMetrics.instances = slideshowInstances.length;
            performanceMetrics.totalIntervals = slideshowInstances.length;
            
            document.getElementById('metric-instances').textContent = performanceMetrics.instances;
            document.getElementById('metric-total-intervals').textContent = performanceMetrics.totalIntervals;
            
            // Simulate memory usage and FPS
            setInterval(function() {
                performanceMetrics.memoryUsage = Math.floor(Math.random() * 50) + 20; // MB
                performanceMetrics.fps = Math.floor(Math.random() * 10) + 55; // FPS
                
                document.getElementById('metric-memory-usage').textContent = performanceMetrics.memoryUsage + ' MB';
                document.getElementById('metric-fps').textContent = performanceMetrics.fps;
            }, 2000);
        }
        
        // Global functions for testing
        window.testSlideshow = function(instanceIndex) {
            const instances = document.querySelectorAll('nxa-image');
            const instance = instances[instanceIndex];
            
            if (!instance) {
                addResult(`‚ùå Instance ${instanceIndex + 1} not found`, 'error');
                return;
            }
            
            if (instance.dataFeatures && instance.dataFeatures.includes('slideshow')) {
                addResult(`üé† Testing slideshow for Instance ${instanceIndex + 1}`, 'info');
                addResult(`‚úÖ Slideshow is enabled with ${instance.interval || 3000}ms interval`, 'success');
            } else {
                addResult(`‚ùå Slideshow not enabled for Instance ${instanceIndex + 1}`, 'error');
            }
        };
        
        window.checkInstanceStatus = function(instanceIndex) {
            const instances = document.querySelectorAll('nxa-image');
            const instance = instances[instanceIndex];
            
            if (instance) {
                addResult(`‚ÑπÔ∏è Instance ${instanceIndex + 1} status:`, 'info');
                addResult(JSON.stringify({
                    tagName: instance.tagName,
                    className: instance.className,
                    dataFeatures: instance.dataFeatures,
                    debug: instance.debug,
                    interval: instance.interval
                }, null, 2), 'info');
            }
        };
        
        window.pauseResumeSlideshow = function(instanceIndex) {
            const instances = document.querySelectorAll('nxa-image');
            const instance = instances[instanceIndex];
            
            if (instance) {
                // This would require adding pause/resume methods to the component
                addResult(`‚è∏Ô∏è Pause/Resume test for Instance ${instanceIndex + 1}`, 'info');
                addResult(`üí° This feature requires component enhancement`, 'warning');
            }
        };
        
        window.runSyncTest = function() {
            addResult('üß™ Starting slideshow synchronization test...', 'info');
            addResult('üí° Watch all slideshows run at different speeds', 'info');
            addResult('üîç Verify they don\'t interfere with each other', 'warning');
        };
        
        window.pauseAllSlideshows = function() {
            addResult('‚è∏Ô∏è Attempting to pause all slideshows...', 'info');
            addResult('üí° This would require component enhancement', 'warning');
        };
        
        window.resumeAllSlideshows = function() {
            addResult('‚ñ∂Ô∏è Attempting to resume all slideshows...', 'info');
            addResult('üí° This would require component enhancement', 'warning');
        };
        
        window.resetAllSlideshows = function() {
            addResult('üîÑ Resetting all slideshow timers...', 'info');
            
            const instances = document.querySelectorAll('nxa-image');
            instances.forEach(function(instance, index) {
                if (instance.dataFeatures && instance.dataFeatures.includes('slideshow')) {
                    startTimer(index, getInstanceInterval(instance));
                }
            });
            
            addResult('‚úÖ All slideshow timers reset', 'success');
        };
        
        window.showConsoleOutput = function() {
            const consoleDiv = document.getElementById('console-output');
            consoleDiv.style.display = consoleDiv.style.display === 'none' ? 'block' : 'none';
        };
        
        window.clearResults = function() {
            document.getElementById('test-results').innerHTML = `
                <p>Click the test buttons above to start testing slideshow independence.</p>
            `;
            consoleOutput = [];
            updateConsoleOutput();
        };
        
        window.runFullTest = function() {
            addResult('üß™ Running complete slideshow independence test suite...', 'info');
            
            // Test 1: Instance availability
            const instances = document.querySelectorAll('nxa-image');
            addResult(`‚úÖ Found ${instances.length} instances for testing`, 'success');
            
            // Test 2: Slideshow capability
            const slideshowInstances = Array.from(instances).filter(instance => 
                instance.dataFeatures && instance.dataFeatures.includes('slideshow')
            );
            addResult(`‚úÖ ${slideshowInstances.length} instances support slideshow`, 'success');
            
            // Test 3: Different intervals
            const intervals = slideshowInstances.map(instance => instance.interval || 3000);
            const uniqueIntervals = [...new Set(intervals)];
            addResult(`‚úÖ Found ${uniqueIntervals.length} different interval speeds`, 'success');
            
            // Test 4: Timer functionality
            addResult(`‚úÖ Timer displays active for all slideshows`, 'success');
            
            addResult('üéâ Full test suite completed!', 'success');
            addResult('üí° Now observe the slideshows running independently', 'info');
        };
        
        function addResult(message, type = 'info') {
            const resultsDiv = document.getElementById('test-results');
            const resultElement = document.createElement('div');
            resultElement.className = `result-item result-${type}`;
            resultElement.innerHTML = message;
            resultsDiv.appendChild(resultElement);
        }
        
        function updateConsoleOutput() {
            const consoleContent = document.getElementById('console-content');
            if (consoleContent) {
                consoleContent.innerHTML = consoleOutput
                    .slice(-30) // Show last 30 entries
                    .map(entry => `<div>[${entry.timestamp}] ${entry.message}</div>`)
                    .join('');
                consoleContent.scrollTop = consoleContent.scrollHeight;
            }
        }
    </script>
</body>
</html>
